---
title: "宽数据转换长数据演示"
author: 潘晚坷
output: html_notebook
---

该代码用于展示如何将宽数据格式转换为长数据格式

https://github.com/HaiyangJin/BayesianLMM-cn


首先，使用R生成虚拟心理学实验宽数据的示例：

- 假设我们要设计一个实验，测试参与者在观看不同颜色的背景下，对文本的阅读速度的影响。
- 我们有三种不同的背景颜色：红色、绿色和蓝色，每种颜色下有5个不同长度的文本段落（长度由单词数决定）。- - 我们随机分配参与者，使每个参与者都能够观看所有三种颜色的背景下的所有文本段落，并记录他们的阅读速度。

下面是一个生成宽数据的示例代码：

```{r}
# 设置随机数种子
set.seed(123)

# 创建实验条件
colors <- c("red", "green", "blue")
lengths <- c(50, 100, 150, 200, 250)

# 创建参与者编号和实验数据
participants <- paste0("P", 1:100)
data <- expand.grid(participant = participants, color = colors, length = lengths)

# 添加阅读速度数据
data$reading_time <- rnorm(nrow(data), mean = 10, sd = 2)

# 查看前几行数据
head(data)
```


现在我们需要将宽数据转换为长数据，以便更容易地进行分析。我们可以使用`tidyr`包中的`pivot_longer`函数来实现。下面是代码示例：

```{r}
library(tidyr)

# 将数据从宽格式转换为长格式
long_data <- pivot_longer(data, cols = c("reading_time"), names_to = "measure", values_to = "value")

# 分离出颜色和文本长度信息
long_data$color <- gsub("reading_time", "", long_data$measure)
long_data$length <- gsub("reading_time", "", long_data$measure)
long_data$length <- as.numeric(gsub("length_", "", long_data$length))

# 删除不需要的列
long_data$measure <- NULL

# 查看前几行数据
head(long_data)
```


现在我们已经将宽数据转换为长数据了，每行代表一个参与者在一个特定颜色和文本长度下的阅读速度。

这样，我们可以更方便地对数据进行分析了。


